{
  "statusCode": "10000",
  "status": 200,
  "message": "",
  "data": {
    "record": {
      "id": 3,
      "title": "Create S3 Bucket with AWS CDK",
      "content": "<p>In this article, I introduce Amazon CDK and how to write AWS infrastructure-as-code using TypeScript. We will do it step by step.</p><p><br></p><h2>What is AWS CDK (Cloud Development Kit)?</h2><p><br></p><p><span style=\"color: rgb(51, 51, 51);\">AWS Cloud Development Kit (AWS CDK) accelerates cloud development using common programming languages to model your applications.</span></p><p><br></p><h2>Setup</h2><p><br></p><p>Step 1: Open command/terminal or PowerShell window</p><p>Step 2: Check node is installed or not. (If not installed, please visit the <a href=\"https://nodejs.org/en\" rel=\"noopener noreferrer\" target=\"_blank\">link</a> to download some settings)</p><pre class=\"ql-syntax\" spellcheck=\"false\">npm --version\n</pre><p><br></p><p>Step 3: Check AWS CLI is installed or not</p><pre class=\"ql-syntax\" spellcheck=\"false\">aws --version\n</pre><p><br></p><p>Step 4: Install the AWS CDK CLI.</p><p><em>Use the npm command below to install the AWS CDK CLI.</em></p><pre class=\"ql-syntax\" spellcheck=\"false\">npm install -g aws-cdkï»¿\n</pre><p><br></p><p>Step 5: Verify AWS CDK is installed</p><pre class=\"ql-syntax\" spellcheck=\"false\">cdk\n</pre><p><br></p><p><img src=\"https://www.dinhthanhcong.info/api/v1/files/load/3485572d662127996c0c3da9cd0f291c\"></p><p>Step 6: Create a CDK project</p><pre class=\"ql-syntax\" spellcheck=\"false\">mkdir agapifa\ncd agapifa\n</pre><p><br></p><p>Step 7: Create the package.json</p><pre class=\"ql-syntax\" spellcheck=\"false\">{\n  \"name\": \"agapifa\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"scripts\": {\n    \"build\": \"npx tsc\",\n    \"start\": \"npm run build -w\",\n    \"cdk\": \"cdk\",\n    \"diff\": \"npx aws-cdk diff\",\n    \"deploy\": \"npx aws-cdk deploy\",\n    \"destroy\": \"npx aws-cdk destroy\",\n    \"lint\": \"eslint .\",\n    \"lint:fix\": \"eslint --fix\",\n    \"format\": \"prettier --write './**/*.{js,jsx,ts,tsx,css,md,json}' --config ./.prettierrc\"\n  },\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"@trivago/prettier-plugin-sort-imports\": \"^4.0.0\",\n    \"@types/node\": \"^18.13.0\",\n    \"@typescript-eslint/eslint-plugin\": \"^5.51.0\",\n    \"aws-cdk\": \"^2.73.0\",\n    \"eslint\": \"^8.34.0\",\n    \"eslint-config-prettier\": \"^8.6.0\",\n    \"eslint-config-standard-with-typescript\": \"^34.0.0\",\n    \"eslint-plugin-import\": \"^2.27.5\",\n    \"eslint-plugin-prettier\": \"^4.2.1\",\n    \"prettier\": \"^2.8.4\",\n    \"ts-node\": \"^10.9.1\",\n    \"typescript\": \"^4.9.5\"\n  },\n  \"dependencies\": {\n    \"aws-cdk-lib\": \"^2.73.0\",\n    \"constructs\": \"^10.1.306\",\n    \"eslint-plugin-n\": \"^15.6.1\",\n    \"eslint-plugin-promise\": \"^6.1.1\",\n    \"source-map-support\": \"^0.5.21\"\n  }\n}\n</pre><p><br></p><p>Step 8: Create tsconfig.json</p><pre class=\"ql-syntax\" spellcheck=\"false\">{\n  \"compilerOptions\": {\n    \"noImplicitAny\": false,\n    \"emitDecoratorMetadata\": true,\n    \"experimentalDecorators\": true,\n    \"target\": \"es2017\",\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n    \"allowJs\": true,\n    \"skipLibCheck\": true,\n    \"strict\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"noEmit\": true,\n    \"esModuleInterop\": true,\n    \"module\": \"commonjs\",\n    \"moduleResolution\": \"node\",\n    \"resolveJsonModule\": true,\n    \"isolatedModules\": true,\n    \"jsx\": \"preserve\",\n    \"incremental\": true,\n    \"baseUrl\": \"./\",\n    \"rootDir\": \"./\",\n    \"outDir\": \"./dist\",\n    \"strictPropertyInitialization\": false,\n    \"paths\": {\n      \"@/*\": [\"src/*\"]\n    }\n  },\n  \"include\": [\"**/*.ts\"],\n  \"exclude\": [\"node_modules\", \"**/node_modules/*\", \"cdk.out\"]\n}\n</pre><p><br></p><p>Step 9: Create cdk.json</p><pre class=\"ql-syntax\" spellcheck=\"false\">{\n  \"app\": \"npx ts-node --prefer-ts-exts lib/index.ts\",\n  \"context\": {\n    \"@aws-cdk/core:newStyleStackSynthesis\": \"true\",\n    \"@aws-cdk/core:bootstrapQualifier\": \"hnb659fds\"\n  }\n}\n</pre><p><br></p><p>Step 10: Code.<em> (Create a directory tree like this)</em></p><p><img src=\"https://www.dinhthanhcong.info/api/v1/files/load/32bc707598ef9a8443b994b0e56a0050\"></p><p>Step 11: Add code to the file lib/index.ts</p><pre class=\"ql-syntax\" spellcheck=\"false\">#!/usr/bin/env node\nimport { App } from 'aws-cdk-lib';\nimport { Construct } from 'constructs';\n\nimport apiStack from './stacks/api-stack';\n\nclass AgapifaApp extends Construct {\n  constructor(scope: App, id: string) {\n    super(scope, id);\n\n    // API Stack\n    new apiStack(this, `${id}-ApiStack`, {\n      stackName: `${id}-ApiStack`,\n    });\n  }\n}\n\nconst app = new App();\n\nnew AgapifaApp(app, 'Agapifa');\n</pre><p><br></p><p>Step 12: Add the below content in lib/stacks/api-stack.ts</p><pre class=\"ql-syntax\" spellcheck=\"false\">import { Stack, StackProps } from 'aws-cdk-lib';\nimport { Construct } from 'constructs';\n\nimport S3Resource from '../../lib/resources/s3';\n\nclass ApiStack extends Stack {\n  constructor(scope: Construct, id: string, props: StackProps) {\n    super(scope, id, props);\n\n    new S3Resource(this, `${id}-S3`, {}).setupBucket('images').setupPolicies().build();\n  }\n}\n\nexport default ApiStack;\n</pre><p><br></p><p>Step 13: Add content to lib/resources/s3/index.ts</p><pre class=\"ql-syntax\" spellcheck=\"false\">import { Stack, StackProps, aws_iam as iam, aws_s3 as s3 } from 'aws-cdk-lib';\n\nclass S3Resource {\n  private _s3Bucket: s3.Bucket;\n  private _scope: Stack;\n  private _scopeId: string;\n\n  constructor(scope: Stack, id: string, props: StackProps) {\n    this._scope = scope;\n    this._scopeId = id;\n  }\n\n  setupBucket(bucketName: string) {\n    this._s3Bucket = new s3.Bucket(this._scope, `${this._scopeId}-${bucketName}`, {\n      bucketName: `${this._scopeId}-${bucketName}`.toLocaleLowerCase(),\n      accessControl: s3.BucketAccessControl.BUCKET_OWNER_FULL_CONTROL,\n      blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,\n      encryption: s3.BucketEncryption.S3_MANAGED,\n    });\n\n    return this;\n  }\n\n  setupPolicies() {\n    this._s3Bucket.addToResourcePolicy(\n      new iam.PolicyStatement({\n        actions: ['*'],\n        principals: [new iam.AnyPrincipal()],\n        resources: [this._s3Bucket.bucketArn, this._s3Bucket.arnForObjects('*')],\n      }),\n    );\n\n    return this;\n  }\n\n  build() {\n    return this._s3Bucket;\n  }\n}\n\nexport default S3Resource;\n</pre><p><br></p><p>Step 14: Build the AWS CDK application</p><pre class=\"ql-syntax\" spellcheck=\"false\">yarn build\n</pre><p><br></p><p>Step 15: Deploy the AWS CDK application</p><p><em>*** You need to bootstrap the AWS CDK application before you can deploy it to AWS</em></p><pre class=\"ql-syntax\" spellcheck=\"false\">cdk bootstrap  --profile agapifa\n</pre><p><br></p><p>Once you've installed it, you can continue with the deployment of the AWS CDK application.</p><pre class=\"ql-syntax\" spellcheck=\"false\">cdk deploy --profile agapifa\n</pre><p><br></p><p>Step 16: Check on the console</p><ul><li>CloudFormation</li></ul><p><img src=\"https://www.dinhthanhcong.info/api/v1/files/load/919d776046184624161b76de05e24a89\"></p><ul><li>S3</li></ul><p><img src=\"https://www.dinhthanhcong.info/api/v1/files/load/8ce0dec7d57c6e9545784c3f8797285e\"></p><h2>Summary</h2><p><br></p><p>In this tutorial, you learned how to install the AWS CDK, set up and initialize an AWS CDK project, assemble it into a CloudFormation template, and deploy to AWS Cloud. If you want to remove the newly created stack from your AWS account, run the following command</p><pre class=\"ql-syntax\" spellcheck=\"false\">cdk destroy --profile agapifa\n</pre><p><br></p><p><em>Good luck with your installation!!!</em></p><p><br></p><h5><em>Next: </em><a href=\"https://www.dinhthanhcong.info/articles/2\" rel=\"noopener noreferrer\" target=\"_blank\">CREATE COGNITO USER POOL WITH AWS CDK</a></h5><p><br></p><p>--------------------------------</p><p><strong>Reference documents:</strong></p><p><br></p><ol><li><a href=\"https://aws.amazon.com/cdk/\" rel=\"noopener noreferrer\" target=\"_blank\">https://aws.amazon.com/cdk/</a></li></ol>",
      "status": "ACTIVATE",
      "thumbnail": {
        "presignedUrl": "/static/images/f813edb6b0a0570fda202be22ee8d762?AWSAccessKeyId=AKIA35KLLR2VHG7F25FA&Expires=1730992720&Signature=flIcoqVOmTv446EvQEtxirycjVM%3D"
      },
      "tags": [
        {
          "id": 3,
          "name": "ReactJS"
        },
        {
          "id": 4,
          "name": "AWS CDK"
        }
      ],
      "author": {
        "id": 1,
        "username": "admin"
      }
    }
  }
}
